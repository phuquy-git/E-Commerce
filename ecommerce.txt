-- public.products definition

-- Drop table

-- DROP TABLE public.products;

CREATE TABLE public.products (
	product_id int4 NOT NULL,
	product_name varchar(255) NOT NULL,
	short_description varchar(500) NULL,
	detail_description varchar(255) NULL,
	technical_description varchar(500) NULL,
	price int8 NOT NULL,
	create_date date NULL,
	update_date date NULL,
	brand_id int4 NOT NULL,
	rating float4 NULL,
	CONSTRAINT products_pk PRIMARY KEY (product_id)
);


-- public.brands definition

-- Drop table

-- DROP TABLE public.brands;

CREATE TABLE public.brands (
	brand_id int4 NOT NULL,
	logo_path varchar(255) NOT NULL,
	brand_name varchar(255) NULL,
	CONSTRAINT brands_pk PRIMARY KEY (brand_id)
);


-- public.categories definition

-- Drop table

-- DROP TABLE public.categories;

CREATE TABLE public.categories (
	category_id int4 NOT NULL,
	category_name varchar(255) NOT NULL,
	description varchar(500) NULL,
	CONSTRAINT categories_pk PRIMARY KEY (category_id)
);


-- public.tags definition

-- Drop table

-- DROP TABLE public.tags;

CREATE TABLE public.tags (
	tag_id int4 NOT NULL,
	tag_name varchar(255) NOT NULL,
	CONSTRAINT tags_pk PRIMARY KEY (tag_id)
);


-- public.addresses definition

-- Drop table

-- DROP TABLE public.addresses;

CREATE TABLE public.addresses (
	address_id int4 NOT NULL,
	user_id int4 NOT NULL,
	city varchar(255) NOT NULL,
	province varchar(255) NOT NULL,
	ward varchar(255) NOT NULL,
	CONSTRAINT addresses_pk PRIMARY KEY (address_id)
);


-- public.shippings definition

-- Drop table

-- DROP TABLE public.shippings;

CREATE TABLE public.shippings (
	ship_via_id int4 NOT NULL,
	ship_type varchar NULL,
	info varchar(500) NULL,
	CONSTRAINT shippings_pk PRIMARY KEY (ship_via_id)
);


-- public.payings definition

-- Drop table

-- DROP TABLE public.payings;

CREATE TABLE public.payings (
	pay_via_id int4 NOT NULL,
	pay_type varchar NOT NULL,
	info varchar(255) NULL
);


-- public.pay_via definition

-- Drop table

-- DROP TABLE public.pay_via;

CREATE TABLE public.pay_via (
	pay_via_id int4 NOT NULL,
	pay_type varchar NOT NULL,
	info varchar(500) NULL,
	CONSTRAINT pay_via_pk PRIMARY KEY (pay_via_id)
);


-- public.pictures definition

-- Drop table

-- DROP TABLE public.pictures;

CREATE TABLE public.pictures (
	picture_id int4 NOT NULL,
	picture_path varchar(255) NOT NULL,
	product_id int4 NULL,
	CONSTRAINT pictures_pk PRIMARY KEY (picture_id),
	CONSTRAINT pictures_fk FOREIGN KEY (product_id) REFERENCES public.products(product_id)
);


-- public.product_categories definition

-- Drop table

-- DROP TABLE public.product_categories;

CREATE TABLE public.product_categories (
	product_id int4 NOT NULL,
	category_id int4 NOT NULL,
	CONSTRAINT product_categories_pk PRIMARY KEY (product_id, category_id),
	CONSTRAINT product_categories_fk FOREIGN KEY (product_id) REFERENCES public.products(product_id),
	CONSTRAINT product_categories_fk_1 FOREIGN KEY (category_id) REFERENCES public.categories(category_id)
);


-- public.product_tags definition

-- Drop table

-- DROP TABLE public.product_tags;

CREATE TABLE public.product_tags (
	product_id int4 NOT NULL,
	tag_id int4 NOT NULL,
	CONSTRAINT product_tags_pk PRIMARY KEY (tag_id, product_id),
	CONSTRAINT product_tags_fk FOREIGN KEY (product_id) REFERENCES public.products(product_id),
	CONSTRAINT product_tags_fk_1 FOREIGN KEY (tag_id) REFERENCES public.tags(tag_id)
);


-- public.users definition

-- Drop table

-- DROP TABLE public.users;

CREATE TABLE public.users (
	user_id int4 NOT NULL,
	phone_number varchar(11) NOT NULL,
	address_id int4 NOT NULL,
	register_date date NULL,
	CONSTRAINT users_pk PRIMARY KEY (user_id),
	CONSTRAINT users_fk FOREIGN KEY (address_id) REFERENCES public.addresses(address_id)
);


-- public.accounts definition

-- Drop table

-- DROP TABLE public.accounts;

CREATE TABLE public.accounts (
	user_id int4 NOT NULL,
	username varchar(255) NOT NULL,
	"password" varchar(255) NOT NULL,
	password_salt varchar(255) NOT NULL,
	user_role varchar(255) NOT NULL,
	first_name varchar(255) NULL,
	last_name varchar(255) NULL,
	last_login date NULL,
	CONSTRAINT accounts_pk PRIMARY KEY (user_id),
	CONSTRAINT accounts_fk FOREIGN KEY (user_id) REFERENCES public.users(user_id)
);


-- public.discounts definition

-- Drop table

-- DROP TABLE public.discounts;

CREATE TABLE public.discounts (
	discount_id int4 NOT NULL,
	discount_price int8 NOT NULL,
	start_date date NULL,
	end_date date NULL,
	create_date date NULL,
	update_date date NULL,
	product_id int4 NOT NULL,
	CONSTRAINT "1_pk" PRIMARY KEY (discount_id),
	CONSTRAINT "1_FK" FOREIGN KEY (product_id) REFERENCES public.products(product_id)
);


-- public.carts definition

-- Drop table

-- DROP TABLE public.carts;

CREATE TABLE public.carts (
	cart_id int4 NOT NULL,
	user_id int4 NOT NULL,
	"valid" bool NOT NULL,
	CONSTRAINT carts_pk PRIMARY KEY (cart_id),
	CONSTRAINT carts_fk FOREIGN KEY (user_id) REFERENCES public.users(user_id)
);


-- public.ratings definition

-- Drop table

-- DROP TABLE public.ratings;

CREATE TABLE public.ratings (
	product_id int4 NOT NULL,
	user_id int4 NOT NULL,
	"comment" varchar(255) NULL,
	rating_score int4 NOT NULL,
	CONSTRAINT ratings_pk PRIMARY KEY (product_id, user_id),
	CONSTRAINT ratings_fk FOREIGN KEY (product_id) REFERENCES public.products(product_id),
	CONSTRAINT ratings_fk_1 FOREIGN KEY (user_id) REFERENCES public.users(user_id)
);


-- public.orders definition

-- Drop table

-- DROP TABLE public.orders;

CREATE TABLE public.orders (
	order_id int4 NOT NULL,
	cart_id int4 NOT NULL,
	order_date date NOT NULL,
	ship_via int4 NOT NULL,
	"name" varchar(60) NOT NULL,
	phone varchar(11) NOT NULL,
	note varchar(500) NULL,
	pay_via int4 NOT NULL,
	cancel_reason varchar(500) NULL,
	shipping_fee int8 NOT NULL,
	address_city varchar(255) NOT NULL,
	address_province varchar(255) NOT NULL,
	address_ward varchar(255) NOT NULL,
	address varchar(255) NOT NULL,
	CONSTRAINT orders_pk PRIMARY KEY (order_id),
	CONSTRAINT orders_fk FOREIGN KEY (cart_id) REFERENCES public.carts(cart_id),
	CONSTRAINT orders_fk_1 FOREIGN KEY (ship_via) REFERENCES public.shippings(ship_via_id),
	CONSTRAINT orders_fk_2 FOREIGN KEY (pay_via) REFERENCES public.pay_via(pay_via_id)
);


-- public.cart_items definition

-- Drop table

-- DROP TABLE public.cart_items;

CREATE TABLE public.cart_items (
	product_id int4 NOT NULL,
	cart_id int4 NOT NULL,
	quantity int4 NOT NULL,
	CONSTRAINT cart_items_pk PRIMARY KEY (product_id, cart_id),
	CONSTRAINT cart_items_fk FOREIGN KEY (product_id) REFERENCES public.products(product_id),
	CONSTRAINT cart_items_fk_1 FOREIGN KEY (cart_id) REFERENCES public.carts(cart_id)
);